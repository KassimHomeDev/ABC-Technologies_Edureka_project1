---
- name: first play - Build and Push Docker Image
  hosts: worker
  gather_facts: false
  become: yes
  tasks:
      # # Task 1: Cleanup any existing code from the previous deployment
      # - name: Remove old application code
      #   file:
      #     path: /home/ubuntu/ansiblejob  # Path to the directory where code is copied
      #     state: absent  # This will remove the directory and its contents
      # # Task 2: Copy the application code to the worker node
      # - name: Copy application code to the worker
      #   copy:
      #     src: /var/lib/jenkins/workspace/ABC-technologie-ansible-docker-k8s/ # Local path on your Ansible control node (Jenkins server)
      #     dest: /home/ubuntu/ansiblejob # Destination on the worker node
      # #Task 3: Build Dockerfile
      # - name: Build Docker image using command module
      #   command: docker build -t kassimabdi/abc-technologie-app-ansible-docker-k8s:latest /home/ubuntu/ansiblejob

      # Push Docker image to Docker Hub
      - name: Push Docker Image to Docker Hub using command module
        command: docker push kassimabdi/abc-technologie-app-ansible-docker-k8s:latest

    

# - name: second play - Deploy Artifact to Kubernetes
#   hosts: master
#   become: yes
#   tasks:
#     # Deploy Artifact in Kubernetes
#     - name: Deploy Artifact in Kubernetes
#       kubernetes.core.k8s:
#         state: present
#         definition: "{{ lookup('file', 'deployment.yml') }}"  
#     # setup service of the app
#     - name: Deploy Artifact in Kubernetes
#       kubernetes.core.k8s:
#         state: present
#         definition: "{{ lookup('file', 'service.yml') }}"  



